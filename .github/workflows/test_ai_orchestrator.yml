name: AI Task Orchestrator Tests

on:
  push:
    branches: [ main, develop ]
    paths:
      - 'api/src/services/ai_task_orchestrator.py'
      - 'api/tests/test_ai_task_orchestrator.py'
  pull_request:
    branches: [ main ]
    paths:
      - 'api/src/services/ai_task_orchestrator.py'
      - 'api/tests/test_ai_task_orchestrator.py'

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        cd api
        pip install pytest pytest-asyncio pytest-cov
        pip install sqlalchemy
    
    - name: Run AI Orchestrator Tests
      run: |
        cd api
        python -m pytest tests/test_ai_task_orchestrator.py -v --cov=src/services/ai_task_orchestrator --cov-report=term-missing
    
    - name: Check for test failures
      if: failure()
      run: |
        echo "❌ AI Task Orchestrator tests failed!"
        echo "This means unnecessary task creation may occur."
        echo "Review test output above."
        exit 1
    
    - name: Success notification
      if: success()
      run: |
        echo "✅ All AI Task Orchestrator tests passed!"
        echo "No unnecessary task creation detected."
